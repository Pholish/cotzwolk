(function(){
	
	var element = document.getElementsByClassName("intro-preloader");
	console.log("preloader element: ", element );
	if( !element.length ) return;
	element = element[0];

	var min_loops = element.dataset.minLoops || 0;

	var PIXEL_RATIO = Math.min( getDevicePixelRatio(), 2 );
	var STAGE_W, STAGE_WH, STAGE_H, STAGE_HH;

// ANIMATION

var lib, images, ss;

/*
 █████╗ ███╗   ██╗██╗███╗   ███╗ █████╗ ████████╗██╗ ██████╗ ███╗   ██╗
██╔══██╗████╗  ██║██║████╗ ████║██╔══██╗╚══██╔══╝██║██╔═══██╗████╗  ██║
███████║██╔██╗ ██║██║██╔████╔██║███████║   ██║   ██║██║   ██║██╔██╗ ██║
██╔══██║██║╚██╗██║██║██║╚██╔╝██║██╔══██║   ██║   ██║██║   ██║██║╚██╗██║
██║  ██║██║ ╚████║██║██║ ╚═╝ ██║██║  ██║   ██║   ██║╚██████╔╝██║ ╚████║
╚═╝  ╚═╝╚═╝  ╚═══╝╚═╝╚═╝     ╚═╝╚═╝  ╚═╝   ╚═╝   ╚═╝ ╚═════╝ ╚═╝  ╚═══╝
*/
//=====================================================================

(function (lib, img, cjs, ss) {

var p; // shortcut to reference prototypes

// library properties:
lib.properties = {
	width: 400,
	height: 400,
	fps: 30,
	color: "#FFFFFF",
	manifest: []
};



// symbols:



(lib.b3 = function() {
	this.initialize();

	// Layer 1
	this.shape = new cjs.Shape();
	this.shape.graphics.f("#FFFFFF").s().p("AjTDUQhYhYABh8QgBh7BYhYQBYhYB7ABQB8gBBYBYQBXBYAAB7QAAB8hXBYQhYBXh8AAQh7AAhYhXg");

	this.addChild(this.shape);
}).prototype = p = new cjs.Container();
p.nominalBounds = new cjs.Rectangle(-30,-30,60,60);


(lib.b2 = function() {
	this.initialize();

	// Layer 1
	this.shape = new cjs.Shape();
	this.shape.graphics.lf(["#FCE6AD","#94E3E6"],[0,1],0,-15,0,15).s().p("AjTDUQhXhYAAh8QAAh6BXhZQBZhXB6AAQB7AABZBXQBXBZAAB6QAAB8hXBYQhZBYh7gBQh6ABhZhYg");

	this.addChild(this.shape);
}).prototype = p = new cjs.Container();
p.nominalBounds = new cjs.Rectangle(-30,-30,60,60);


(lib.b1 = function() {
	this.initialize();

	// Layer 1
	this.shape = new cjs.Shape();
	this.shape.graphics.lf(["#A6C4E6","#CEA7F4"],[0,1],0,-15,0,15).s().p("AjTDUQhXhYAAh8QAAh6BXhZQBZhXB6AAQB7AABZBXQBXBZAAB6QAAB8hXBYQhZBYh7gBQh6ABhZhYg");

	this.addChild(this.shape);
}).prototype = p = new cjs.Container();
p.nominalBounds = new cjs.Rectangle(-30,-30,60,60);


(lib.b1_l = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// Layer 3
	this.shape = new cjs.Shape();
	this.shape.graphics.lf(["#A6C4E6","#CEA7F4"],[0,1],0,-15,0,15).s().p("AjTDUQhXhYAAh8QAAh7BXhXQBZhZB6ABQB7gBBZBZQBXBXAAB7QAAB8hXBYQhZBYh7AAQh6AAhZhYg");
	this.shape.setTransform(0,-160);

	this.shape_1 = new cjs.Shape();
	this.shape_1.graphics.lf(["#B3C9DD","#C5B0F2"],[0,1],0,-15,0,15).s().p("AjTDUQhYhYAAh8QAAh7BYhXQBYhZB7AAQB8AABXBZQBZBXAAB7QAAB8hZBYQhXBYh8AAQh7AAhYhYg");
	this.shape_1.setTransform(0.1,-157.2);

	this.shape_2 = new cjs.Shape();
	this.shape_2.graphics.lf(["#C6D1D1","#B8BEEF"],[0,1],0,-15,0,15).s().p("AjSDUQhZhYABh8QgBh7BZhXQBXhZB7ABQB7gBBZBZQBXBXAAB7QAAB8hXBYQhZBYh7AAQh7AAhXhYg");
	this.shape_2.setTransform(0.1,-153.2);

	this.shape_3 = new cjs.Shape();
	this.shape_3.graphics.lf(["#DEDAC1","#A8CEEB"],[0,1],0,-15,0,15).s().p("AjTDUQhXhYgBh8QABh7BXhXQBYhZB7AAQB8AABXBZQBZBXgBB7QABB8hZBYQhXBYh8AAQh7AAhYhYg");
	this.shape_3.setTransform(0.2,-148.2);

	this.shape_4 = new cjs.Shape();
	this.shape_4.graphics.lf(["#FCE6AD","#94E3E6"],[0,1],0,-15,0,15).s().p("AjTDUQhXhYgBh8QABh7BXhXQBZhZB6ABQB8gBBXBZQBZBXgBB7QABB8hZBYQhXBYh8AAQh6AAhZhYg");
	this.shape_4.setTransform(0.3,-142);

	this.shape_5 = new cjs.Shape();
	this.shape_5.graphics.lf(["#FCE6AD","#94E3E6"],[0,1],0,-15.5,0,15.6).s().p("AjJDcQhUhcgBiAQABh/BUhbQBUhcB1AAQB2AABVBcQBTBbAAB/QAACAhTBcQhVBbh2AAQh1AAhUhbg");
	this.shape_5.setTransform(0.1,-133.9);

	this.shape_6 = new cjs.Shape();
	this.shape_6.graphics.lf(["#FCE6AD","#94E3E6"],[0,1],0,-16.5,0,16.5).s().p("Ai5DqQhOhiAAiIQAAiHBOhhQBNhhBsAAQBtAABOBhQBNBhABCHQgBCIhNBiQhOBghtAAQhsAAhNhgg");
	this.shape_6.setTransform(-0.1,-120.4);

	this.shape_7 = new cjs.Shape();
	this.shape_7.graphics.lf(["#FCE6AD","#94E3E6"],[0,1],0,-16.9,0,17).s().p("Ai3DwQhNhkAAiMQAAiLBNhjQBNhkBqAAQBsAABMBkQBNBjAACLQAACMhNBkQhMBjhsAAQhqAAhNhjg");
	this.shape_7.setTransform(-0.1,-90.3);

	this.shape_8 = new cjs.Shape();
	this.shape_8.graphics.lf(["#FCE6AD","#94E3E6"],[0,1],0,-17.4,0,17.4).s().p("Ai1D2QhLhmAAiQQAAiOBLhmQBMhmBpAAQBqAABMBmQBLBmAACOQAACQhLBmQhMBlhqAAQhpAAhMhlg");
	this.shape_8.setTransform(0,-60.2);

	this.shape_9 = new cjs.Shape();
	this.shape_9.graphics.lf(["#FCE6AD","#94E3E6"],[0,1],0,-17.8,0,17.8).s().p("AiyD8QhKhpAAiTQAAiSBKhoQBKhpBoAAQBoAABLBpQBKBoAACSQAACThKBpQhLBohoAAQhoAAhKhog");
	this.shape_9.setTransform(0,-30.1);

	this.timeline.addTween(cjs.Tween.get({}).to({state:[]}).to({state:[{t:this.shape}]},29).to({state:[{t:this.shape_1}]},1).to({state:[{t:this.shape_2}]},1).to({state:[{t:this.shape_3}]},1).to({state:[{t:this.shape_4}]},1).to({state:[{t:this.shape_5}]},1).to({state:[{t:this.shape_6}]},1).to({state:[{t:this.shape_7}]},1).to({state:[{t:this.shape_8}]},1).to({state:[{t:this.shape_9}]},1).to({state:[]},1).wait(1));

	// Layer 1
	this.instance = new lib.b1();
	this.instance.setTransform(0,0,0.05,0.05);

	this.timeline.addTween(cjs.Tween.get(this.instance).to({scaleX:0.57,scaleY:0.57,y:-77.2},14,cjs.Ease.get(-1)).to({scaleX:1,scaleY:1,y:-160},13,cjs.Ease.get(1)).to({_off:true},2).wait(11));

}).prototype = p = new cjs.MovieClip();
p.nominalBounds = new cjs.Rectangle(-1.5,-1.5,3,3);


// stage content:



(lib.preloader = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{out:30});

	// timeline functions:
	this.frame_29 = function() {
		this.stop();
		preloaderShowed( this );
	}
	this.frame_56 = function() {
		this.stop();
		preloaderComplete( this );
	}

	// actions tween:
	this.timeline.addTween(cjs.Tween.get(this).wait(29).call(this.frame_29).wait(27).call(this.frame_56).wait(3));

	// Layer 4
	this.instance = new lib.b3();
	this.instance.setTransform(200,200,0.083,0.083);
	this.instance._off = true;

	this.timeline.addTween(cjs.Tween.get(this.instance).wait(43).to({_off:false},0).to({scaleX:2.08,scaleY:2.08},4,cjs.Ease.get(-1)).to({scaleX:6.08,scaleY:6.08},11,cjs.Ease.get(1)).wait(1));

	// Layer 3
	this.instance_1 = new lib.b2();
	this.instance_1.setTransform(200,200,1.033,1.033);
	this.instance_1._off = true;

	this.timeline.addTween(cjs.Tween.get(this.instance_1).wait(39).to({_off:false},0).to({scaleX:2.45,scaleY:2.45},5,cjs.Ease.get(-1)).to({scaleX:5.92,scaleY:5.92},13,cjs.Ease.get(1)).to({_off:true},1).wait(1));

	// Layer 2
	this.instance_2 = new lib.b1_l("synched",0,false);
	this.instance_2.setTransform(200,200,1,1,-178);

	this.timeline.addTween(cjs.Tween.get(this.instance_2).to({_off:true},39).wait(20));

	// Layer 1
	this.instance_3 = new lib.b1_l("synched",0,false);
	this.instance_3.setTransform(200,200,1,1,2);

	this.timeline.addTween(cjs.Tween.get(this.instance_3).to({_off:true},39).wait(20));

}).prototype = p = new cjs.MovieClip();
p.nominalBounds = new cjs.Rectangle(398.5,398.5,3,3);

})(lib = lib||{}, images = images||{}, createjs = createjs||{}, ss = ss||{});

//=====================================================================
/*
 █████╗ ███╗   ██╗██╗███╗   ███╗ █████╗ ████████╗██╗ ██████╗ ███╗   ██╗
██╔══██╗████╗  ██║██║████╗ ████║██╔══██╗╚══██╔══╝██║██╔═══██╗████╗  ██║
███████║██╔██╗ ██║██║██╔████╔██║███████║   ██║   ██║██║   ██║██╔██╗ ██║
██╔══██║██║╚██╗██║██║██║╚██╔╝██║██╔══██║   ██║   ██║██║   ██║██║╚██╗██║
██║  ██║██║ ╚████║██║██║ ╚═╝ ██║██║  ██║   ██║   ██║╚██████╔╝██║ ╚████║
╚═╝  ╚═╝╚═╝  ╚═══╝╚═╝╚═╝     ╚═╝╚═╝  ╚═╝   ╚═╝   ╚═╝ ╚═════╝ ╚═╝  ╚═══╝
*/





	/*
██████╗ ███████╗███╗   ██╗██████╗ ███████╗██████╗ 
██╔══██╗██╔════╝████╗  ██║██╔══██╗██╔════╝██╔══██╗
██████╔╝█████╗  ██╔██╗ ██║██║  ██║█████╗  ██████╔╝
██╔══██╗██╔══╝  ██║╚██╗██║██║  ██║██╔══╝  ██╔══██╗
██║  ██║███████╗██║ ╚████║██████╔╝███████╗██║  ██║
╚═╝  ╚═╝╚══════╝╚═╝  ╚═══╝╚═════╝ ╚══════╝╚═╝  ╚═╝
*/
	
	var LOADING = "LOADING";
	var ALL_LOADED = "ALL_LOADED";
	var ANIM_OUT = "ANIM_OUT";
	var state = LOADING;

	var loops = 0;

	//	RENDER
	var canvas = document.createElement('canvas');
	canvas.width = 400;
	canvas.height = 400;
	element.appendChild( canvas );

	var exportRoot = new lib.preloader();
	exportRoot.x = exportRoot.regX = canvas.width/2;
	exportRoot.y = exportRoot.regY = canvas.height/2;
	exportRoot.stop();
	exportRoot.visible = false;

	var stage = new createjs.Stage(canvas);
	stage.addChild(exportRoot);
	stage.update();

	var ticker = createjs.Ticker;
	ticker.setFPS(lib.properties.fps);
	ticker.addEventListener("tick", stage);

	setTimeout(function() {
		rotate();
		exportRoot.gotoAndPlay(1);
		exportRoot.visible = true;
	}, 120)

	function rotate(){

		createjs.Tween
			.get(exportRoot)
			.to({
				rotation: 360
			}, 1200, createjs.Ease.cubicInOut )
			.call(function() {
				
				console.log("rotation done");
				exportRoot.rotation = 0;
				
				loops++;
				if( ALL_LOADED && loops >= min_loops && document.readyState=="complete" && $ ){
					animateOut();
				}else{
					rotate();
				}
			});
	}


	function  preloaderShowed (clp) {
		clp.stop();
	}

	function animateOut(){
		state = ANIM_OUT;
		exportRoot.gotoAndPlay("out");
	}

	function preloaderComplete( clp ){
		ticker.removeEventListener("tick", stage );
		var $element = $(element)
			.trigger("preloader:animation-complete")
			.fadeOut(300, function(){
				$element.trigger("preloader:hidden");
			});

		$(canvas).remove();
	}


	//
	document.addEventListener("DOMContentLoaded", onReady);
	function onReady () {
		$(function(){
			state = ALL_LOADED;
		});
	}
	// SCENE


	// Utils

	function getDevicePixelRatio() {
      var ratio = 1;
      // To account for zoom, change to use deviceXDPI instead of systemXDPI
      if (window.screen.systemXDPI !== undefined && window.screen.logicalXDPI !== undefined && window.screen.systemXDPI > window.screen.logicalXDPI) {
          // Only allow for values > 1
          ratio = window.screen.systemXDPI / window.screen.logicalXDPI;
      }
      else if (window.devicePixelRatio !== undefined) {
          ratio = window.devicePixelRatio;
      }
      return ratio;
  };

})();
